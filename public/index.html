<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Sales Product Request Form</title>
  
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/typeaheadjs.css">
  <script src="/js/typeahead.bundle.min.js"></script>
 <!-- <script src="/js/app.js"></script> -->
</head>
<body>
  <div class="container">
    <h1>Product Request Form</h1>

    <!-- Start of form -->
    <form role="form" action="javascript:write_row();">

      <fieldset class="form-group sfdc-hide">
        <label for="usr">Sales Rep:</label>
        <input type="text" name="user" class="form-control typeahead" id="usr" required placeholder="First Last">
        <input type="text" name="uemail" class="form-control typeahead" id="usremail" required placeholder="first@segment.com">
      </fieldset>

      <fieldset class="form-group sfdc-hide">
        <label for="usr">Sales Engineer:</label>
        <input type="text" name="seuser" class="form-control typeahead" id="seusr" required placeholder="First Last">
        <input type="text" name="semail" class="form-control typeahead" id="seusremail" required placeholder="first@segment.com">
      </fieldset>
      <fieldset class="form-group">
        <label for="sel1">Request Category:</label>
        <select class="form-control" id="sel1" name="category" required>
          <option value="" disabled selected hidden>---What is your request in regards to?----</option>
          <option value="Integrations">Downstream Integration</option>
          <option value="Source Integrations">Source Integration</option>
          <option value="Sources & Warehouses">Warehouse Integration</option>
          <option value="App">Segment App</option>
        </select>
      </fieldset>

      <fieldset class="form-group show-integration" style="display:none">
        <div>
          <label>Type of Request</label>
        </div>
        <label class="radio-inline"><input type="radio" value="New Integration" name="type-radio">New Integration</label>
        <label class="radio-inline"><input type="radio" value="Improvement" name="type-radio">Upgrade to Current Integration</label>
        <label class="radio-inline"><input type="radio" value="Bug" name="type-radio">Bug Fix</label>
      </fieldset>

      <fieldset class="form-group show-feature" style="display:none">
        <div>
          <label>Type of Request</label>
        </div>
        <label class="radio-inline"><input type="radio" value="New Integration" name="type-radio">New Feature</label>
        <label class="radio-inline"><input type="radio" value="Improvement" name="type-radio">Improvement to App</label>
        <label class="radio-inline"><input type="radio" value="Bug" name="type-radio">Bug Fix</label>
      </fieldset>

      <fieldset class="form-group">
        <label for="request">Request Details (product/integration specifics):</label>
        <input name="request" type="text" class="form-control" id="request-details" required placeholder="Describe your request">
      </fieldset>

      <fieldset class="form-group">
        <div>
          <label>Impact on deal?</label>
        </div>
        <div>
        <label class="radio-inline"><input type="radio" value="1" name="impact-radio" checked>1 - Nice to Have (no effect on price or timing)</label>
        <br>
        <label class="radio-inline"><input type="radio" value="2" name="impact-radio" >2 - Need for Future (no effect on price or timing but next renewal will be hard without this request being met)</label>
        <br>
        <label class="radio-inline"><input type="radio" value="3" name="impact-radio" >3 - Deal Stalled (not having this request is slowing the sales cycle)</label>
        <br>
         <label class="radio-inline"><input type="radio" value="4" name="impact-radio" >4 - Revenue Impact (not having this request is lowering the deal value)</label>
          <br>
          <label class="radio-inline"><input type="radio" value="5" name="impact-radio" >5 - Deal at Risk (without this request it is unlikely the deal will close)</label>
          <br>
          <label class="radio-inline"><input type="radio" value="6" name="impact-radio" >6 - Deal Blocked (this deal is closed-lost until this request is met)</label>
          </div>
      </fieldset>

      <fieldset class="form-group">
        <label for="comments">Other Comments</label>
        <textarea name="comments" class="form-control" id="other" rows="3" placeholder="Anything else we should know?"></textarea>
      </fieldset>

      <fieldset class="form-group">
        <label for="company">Company:</label>
        <input name="company" class="form-control" id="company" required placeholder="Segment">
      </fieldset>

      <fieldset class="form-group">
        <div>
          <label>Team</label>
        </div>
        <label class="radio-inline"><input type="radio" value="BI/Analytics" name="team-radio" name="BI/Analytics" checked>BI/Analytics</label>
        <label class="radio-inline"><input type="radio" value="Marketing" name="team-radio">Marketing</label>
        <label class="radio-inline"><input type="radio" value="Product" name="team-radio">Product</label>
        <label class="radio-inline"><input type="radio" value="Engineering" name="team-radio">Engineering</label>
      </fieldset>

      <fieldset class="form-group sfdc-hide">
        <label for="deal-size">Potential Deal Size?</label>
        <div class="input-group">
          <span class="input-group-addon">$</span>
          <input type="number" name="potential-deal-size" class="form-control" aria-label="Amount (to the nearest dollar)" id="deal-size" placeholder="10000">
          <span class="input-group-addon">.00</span>
        </div>
      </fieldset>

      <fieldset class="form-group sfdc-hide">
        <div>
          <label>Current Deal Stage</label>
        </div>
        <label class="radio-inline"><input type="radio" value="1" name="stage-radio" checked>Qualified Opportunity</label>
        <label class="radio-inline"><input type="radio" value="2" name="stage-radio">Demo</label>
        <label class="radio-inline"><input type="radio" value="3" name="stage-radio">Pricing Discussion</label>
        <label class="radio-inline"><input type="radio" value="4" name="stage-radio">Negotiation</label>
        <label class="radio-inline"><input type="radio" value="5" name="stage-radio">Closed-Lost</label>
        <label class="radio-inline"><input type="radio" value="6" name="stage-radio">Closed-Won</label>
        <label class="radio-inline"><input type="radio" value="7" name="stage-radio">Renewal</label>

      </fieldset>

      <input type="hidden" name="urgent" id="urgent" value="No">

      <div id="buttons">
        <button type="submit" id="sbmt" class="btn btn-primary">Submit</button>
        <div class="btn btn-primary btn-urgent" style="float:right;cursor:pointer;" onclick="urgent()">Urgent Request</div>
      </div>
    </form>
  </div>

<script>
//set urgent hidden field to default value of No
$('#urgent').val("No");
// fill fields based on query parameters
function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
$('#usr').val(getParameterByName('name'));
$('#usremail').val(getParameterByName('email'));
$('#seusr').val(getParameterByName('sales_engineer'))
$('#seusremail').val(getParameterByName('sales_engineer_email'))
$('#company').val(getParameterByName('company'));
$('#deal-size').val(getParameterByName('deal_size'));

//Show appropiate request type field based on category selection
function watchForChange(){
  if($('#sel1').val() != null){
    $('.show-integration').toggle($('#sel1').val().includes("Integration")||$('#sel1').val().includes("Warehouse"))
    $('.show-feature').toggle($('#sel1').val().includes("App"))
  }
}
setInterval(watchForChange, 250)

// Determine if urgent request or not
function urgent(){
  answer = false;
  answer = confirm('Marking this request as urgent will create a JIRA ticket and notify Tido & Ilya, do you want to continue?');
  if (answer) {
    // Save it!
    $('#urgent').val("Yes");
    $('#sbmt').click();

} else {
    $('#urgent').val("No");
}
}


//write to google spreadsheet
function write_row() {
          jira_id_dict = {"Integrations":"10300","Source Integrations":"10701","App":"10900","Sources & Warehouses":"10100","Improvement":"10203"};
          jira_issue_id_dict = {"Improvement":"10002","New Feature":"10002","Bug":"10004","New Integration":"10002"}
          url = 'https://script.google.com/a/macros/segment.com/s/AKfycbxc9U5KMl_cZN_3YJ6W3-K7pyu0nfkt--8Kf_4_dCogicpiDJA/exec';
          nm = $('#usr').val();
          ctgy = $('#sel1').val();
          jrid = jira_id_dict[ctgy];
          typ = $("input:radio[name='type-radio']:checked").val();
          jrssid = jira_issue_id_dict[typ];
          dts = $('#request-details').val();
          mpct = $("input:radio[name='impact-radio']:checked").val();
          cmmts = $('#other').val();
          cmpny = $('#company').val();
          tm = $("input:radio[name='team-radio']:checked").val();
          dlsz = $('#deal-size').val();
          stg = $("input:radio[name='stage-radio']:checked").val();
          rgnt = $("#urgent").val();
          eml = $('#usremail').val();
          se = $('#seusr').val();
          seeml = $('#seusremail').val();
          row_to_write = [nm,ctgy,typ,dts,mpct,cmmts,cmpny,tm,dlsz,stg];
          console.log(url);
          console.log(row_to_write);
          $.get( url, {Requester_Name:nm,Requester_Email:eml,SE:se,SE_Email:seeml,Request_Category:ctgy,Jira_Id:jrid,Request_Type:typ,Issue_Id:jrssid,Request_Details:dts,Deal_Impact:mpct,Other_Comments:cmmts,Company:cmpny,Deal_Size:dlsz,Deal_Stage:stg,Urgent:rgnt}, function(){
            window.location.href = 'https://docs.google.com/spreadsheets/d/1HK1VShTuPlTeSCtlcj0vwwgbq6K49WcQBZ7kW4rKmAg/edit#gid=0';
          });
}


</script>
</body>


</html>